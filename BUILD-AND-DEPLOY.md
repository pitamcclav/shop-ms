# 🏗️ Building for cPanel Deployment

## CRITICAL: You MUST Build Before Deploying!

The 503 error you experienced is because the `.next` folder doesn't exist. This folder is created during the build process and contains the compiled Next.js application.

---

## ⚡ Quick Build Guide

### Step 1: Build Locally (Required!)

```bash
cd "c:\Users\HP\Desktop\New folder\projects\Shop Management System\shop-ms"

# Build the application
npm run build
```

**What this does:**
- Creates the `.next/` folder with compiled code
- Optimizes all pages and API routes
- Generates static assets
- Prepares production bundles

You should see output like:
```
✓ Creating an optimized production build
✓ Compiled successfully
✓ Collecting page data
✓ Generating static pages (4/4)
✓ Finalizing page optimization

Route (app)                              Size
┌ ○ /                                    X kB
├ ○ /api/products                        Y kB
├ ○ /api/purchases                       Y kB
├ ○ /api/sales                           Y kB
└ ○ /api/stats                           Y kB
```

### Step 2: Verify .next Folder Exists

Check that these folders were created:
```
shop-ms/
├── .next/
│   ├── server/
│   ├── static/
│   └── ... (other build files)
```

---

## 📦 What to Upload to cPanel

### ✅ Required Files/Folders:

```
MUST UPLOAD:
├── .next/                    ← BUILD OUTPUT (Generated by npm run build)
├── public/                   ← Static files
├── src/                      ← Source code
│   ├── app/                  ← Pages and API routes
│   ├── components/           ← React components
│   ├── lib/                  ← Database connection
│   └── types/                ← TypeScript definitions
├── app.js                    ← cPanel startup file
├── package.json              ← Dependencies list
├── package-lock.json         ← Locked versions
├── next.config.ts            ← Next.js configuration
├── tsconfig.json             ← TypeScript config
├── setup-mysql.ts            ← Database setup script
└── .env.production           ← Production environment variables
```

### ❌ Do NOT Upload:

```
DON'T UPLOAD:
├── node_modules/             ← Install on server instead
├── .env.local                ← Local development only
├── .git/                     ← Version control
├── shop.db                   ← Old SQLite database
├── migrate.ts                ← Old SQLite migration
└── migrate-units.ts          ← Old SQLite migration
```

---

## 🎯 Deployment Steps Summary

### 1. Local Build
```bash
npm run build
```

### 2. Create .env.production
Create this file with your cPanel MySQL credentials:
```env
NODE_ENV=production
DB_HOST=localhost
DB_PORT=3306
DB_USER=your_cpanel_db_user
DB_PASSWORD=your_cpanel_db_password
DB_NAME=your_cpanel_db_name
```

### 3. Upload via FTP/File Manager
Upload all required files (including `.next` folder!)

### 4. Install Dependencies on Server
```bash
# In cPanel Terminal
cd /home/username/subdomain.domain.com
npm install --production
```

### 5. Setup Database
```bash
npx tsx setup-mysql.ts
```

### 6. Configure Node.js App in cPanel
- Application root: Your subdomain directory
- Application startup file: `app.js`
- Application mode: Production
- Click Start

---

## 🔧 Why the .next Folder is Critical

### Without .next folder:
- ❌ Next.js can't find compiled pages
- ❌ API routes don't work
- ❌ Results in 503 errors
- ❌ App fails to start

### With .next folder:
- ✅ All pages pre-compiled and optimized
- ✅ API routes work immediately
- ✅ Fast server startup
- ✅ Production-ready performance

---

## 🚨 Common Mistakes

### ❌ Mistake 1: Only running `npm install`
```bash
npm install  # This installs dependencies but doesn't build the app!
```

### ✅ Correct: Build the application
```bash
npm install   # Install dependencies
npm run build # Build the application (creates .next folder)
```

### ❌ Mistake 2: Forgetting to upload .next folder
Even if you build locally, you must upload the `.next` folder to cPanel!

### ❌ Mistake 3: Building on cPanel
Don't try to run `npm run build` directly on cPanel - it may timeout or fail. Always build locally first!

---

## 📝 Complete Deployment Checklist

- [ ] 1. Run `npm run build` locally
- [ ] 2. Verify `.next` folder exists
- [ ] 3. Create `.env.production` with cPanel database credentials
- [ ] 4. Create MySQL database on cPanel
- [ ] 5. Upload all files INCLUDING `.next` folder
- [ ] 6. Rename `.env.production` to `.env.local` on server
- [ ] 7. Run `npm install --production` in cPanel terminal
- [ ] 8. Run `npx tsx setup-mysql.ts` to create tables
- [ ] 9. Configure Node.js app with `app.js` as startup file
- [ ] 10. Start the application
- [ ] 11. Test at your subdomain URL

---

## 🎉 After Successful Deployment

Visit your subdomain and you should see:
- ✅ Login/main page loads
- ✅ Can create products
- ✅ Can add stock
- ✅ Can make sales
- ✅ Dashboard shows statistics

---

## 🆘 Troubleshooting 503 Errors

### If you still get 503:

1. **Check .next folder exists on server**
   ```bash
   ls -la .next/
   ```

2. **Check app.js exists**
   ```bash
   ls -la app.js
   ```

3. **Check Node.js app status in cPanel**
   - Should show "Running" in green

4. **Check error logs**
   - In cPanel Node.js App, click "View Log"

5. **Verify environment variables**
   - Database credentials are correct
   - `NODE_ENV=production`

6. **Restart the application**
   - In Node.js App, click "Restart"

---

## 💡 Pro Tips

1. **Build locally, deploy the built files** - Don't try to build on cPanel
2. **Keep .next folder updated** - Rebuild and reupload when you make changes
3. **Use production environment file** - Separate from local development
4. **Test build locally first** - Run `npm start` to test production build
5. **Compress before upload** - Zip the files to upload faster

---

## 📊 Build Size Reference

Typical `.next` folder size: **15-30 MB**

If your build is much larger, you may want to optimize:
- Remove unused dependencies
- Optimize images
- Check for large packages

---

## 🔄 Updating After Changes

When you make code changes:

```bash
# 1. Make your changes
# 2. Test locally
npm run dev

# 3. Build again
npm run build

# 4. Upload ONLY changed files + new .next folder
# 5. Restart app in cPanel
```

No need to run `npm install` again unless you added new dependencies.

---

Remember: **BUILD → UPLOAD → INSTALL → SETUP DB → START**
